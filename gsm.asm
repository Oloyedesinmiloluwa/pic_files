TMR0	EQU	1
PC		EQU	2
STATUS	EQU	3
PORTA	EQU	5
PORTB	EQU	6
PORTC	EQU	7
PORTD	EQU	8
PORTE	EQU	9
TRISA	EQU	85H
TRISB	EQU	86H
TRISC	EQU	87H
TRISD	EQU	88H
TRISE	EQU	89H
OPTION_R	EQU 81H
ZEROBIT	EQU	2
;CCP1CON	EQU	17H
INTCON	EQU 0BH
GIE		EQU	7
PIE1	EQU	8CH
PIR1	EQU	0CH
PEIE	EQU	6
CCP1IF	EQU	2
CCP1IE	EQU	2
EDGE	EQU	0
READY	EQU	1
EEDATA		EQU	0CH
EEADR		EQU	0DH
EECON1		EQU	8CH
EECON2		EQU	8DH
RD EQU 0 ;read bit in EECON1
WR EQU 1 ;Write bit in EECON1
WREN EQU 2
RCSTA	EQU 18H
TXSTA	EQU	98H
SPBRG	EQU	99H
TXIE	EQU	4
RCIE	EQU	5
CREN	EQU	4
TXEN	EQU	5
TXIF	EQU 4
RCIF	EQU	5
TXREG	EQU	19H
RCREG	EQU	1AH
FRAME	EQU	1
FERR	EQU	2		
COUNT	EQU	20H
RECV	EQU	21H
FLAG	EQU	22H
C3		EQU	23H
C4		EQU	24H
C5		EQU	25H
DISP1	EQU	26H
TSTATUS		EQU	69H
TW		EQU	6AH
TPORTB		EQU	6BH
TNUM	EQU	6CH		
COUNTER		EQU	6DH
NUM		EQU	6EH
COUNTER2 EQU	6FH
ALPHA	EQU		2BH
DELAYCOUNT	EQU	2CH	
SHIFTCOUNT	EQU	2DH	
STORE	EQU		2EH
FILE1	EQU		3AH
FILE2	EQU		3BH

	LIST	P=16F877A
	ORG		0
	GOTO	START
	ORG		4
	GOTO	ISR
	__CONFIG	H'3F3A'
;SUBROUTINE

DELAYWAIT MOVLW	.255			;for waiti
		MOVWF	DELAYCOUNT
DEL3	DECFSZ	DELAYCOUNT
		GOTO 	DELAY4
		RETLW  	.0
		
DELAY4 CLRF TMR0 ;START TMR0.
LOOPC MOVF TMR0,W ;READ TMR0 INTO W.
		SUBLW .255 ;TIME-3
	BTFSS STATUS,ZEROBIT ;Check TIME-W ¼ 0
	GOTO LOOPC ;Time is not ¼ 3.
	GOTO DEL3

ISR		MOVWF	TW
		SWAPF	STATUS,W
		MOVWF	TSTATUS
		MOVF	PORTB,W
		MOVWF	TPORTB
		BCF		FLAG,FRAME
		BTFSC	RCSTA,FERR
		BSF		FLAG,FRAME
		MOVF	RCREG,W
		SUBLW	4FH
		BTFSS	STATUS,ZEROBIT
;		GOTO	rest
		MOVWF	RECV
		BSF		FLAG,0
		BSF		PORTC,0
		CALL	DELAYWAIT
		BCF		PORTC,0
		CALL	DELAYWAIT

rest	MOVF	TPORTB,W
		MOVWF	PORTB
		SWAPF	TSTATUS,W
		MOVWF	STATUS
		MOVF	TW,W
		RETFIE

TX			MOVWF	TXREG
	WAIT	BTFSS	PIR1,TXIF
			GOTO	WAIT
			RETURN	
A			MOVLW	41H
			CALL	TX
			RETURN
BB			MOVLW	42H
			CALL	TX
			RETURN
C			MOVLW	43H
			CALL	TX
			RETURN
D			MOVLW	44H
			CALL	TX
			RETURN
E			MOVLW	45H
			CALL	TX
			RETURN
F			MOVLW	46H
			CALL	TX
			RETURN
G			MOVLW	47H
			CALL	TX
			RETURN
H			MOVLW	48H
			CALL	TX
			RETURN
I			MOVLW	49H
			CALL	TX
			RETURN
M			MOVLW	4DH
			CALL	TX
			RETURN
N			MOVLW	4EH
			CALL	TX
			RETURN
T			MOVLW	54H
			CALL	TX
			RETURN
P			MOVLW	50H
			CALL	TX
			RETURN
R			MOVLW	52H
			CALL	TX
			RETURN
S			MOVLW	53H
			CALL	TX
			RETURN
U			MOVLW	55H
			CALL	TX
			RETURN
PLUS		MOVLW	2BH
			CALL	TX
			RETURN
EQUAL		MOVLW	3DH
			CALL	TX
			RETURN
SLASH		MOVLW	5CH
			CALL	TX
			RETURN
LT			MOVLW	3CH
			CALL	TX
			RETURN
GT			MOVLW	3EH
			CALL	TX
			RETURN
rr			MOVLW	72H
			CALL	TX
			RETURN
n			MOVLW	6EH
			CALL	TX
			RETURN
M1			MOVLW	31H
			CALL	TX
			RETURN
M0			MOVLW	30H
			CALL	TX
			RETURN
M2			MOVLW	32H
			CALL	TX
			RETURN
M3			MOVLW	33H
			CALL	TX
			RETURN
M4			MOVLW	34H
			CALL	TX
			RETURN
M5			MOVLW	35H
	 		CALL	TX
			RETURN
M6			MOVLW	36H
			CALL	TX
			RETURN
M7			MOVLW	37H
			CALL	TX
			RETURN
M8			MOVLW	38H
			CALL	TX
			RETURN
M9			MOVLW	39H
			CALL	TX
			RETURN
QUO			MOVLW	22H
			CALL	TX
			RETURN
SEMI		MOVLW	3BH
			CALL	TX
			RETURN
CtrlZ		MOVLW	1AH
			CALL	TX
			RETURN
CARRIAGE	MOVLW	0DH
			CALL	TX
			RETURN
;		BSF		STATUS,5
;		MOVLW	.1
;		MOVWF	TRISB
;		MOVLW	.0
;		MOVWF	TRISA
;		BSF		TRISC,7
;		BCF		TRISC,6
;		MOVLW	.0
;		MOVWF	TRISD
;		MOVLW	.0
;		MOVWF	TRISE
;		MOVLW	07H
;		MOVWF	OPTION_R
;		BSF		PIE1,TXIE
;		CLRF	STATUS
;		CLRF	PORTA
;		CLRF	PORTB
;		CLRF	PORTD		
;		CLRF	PORTE	
;		CLRF	FLAG
;	
;		BCF		PIR1,RCIF
;		MOVLW	80H
;		MOVWF	RCSTA	; RECEIVE MODE
;		BSF		STATUS,5
;		MOVLW	.12
;		MOVWF	SPBRG; FOR BAUD RATE
;		
;		BSF		TXSTA,4	
;		BSF		TXSTA,2
;		BSF		TXSTA,6	
;		BSF		PIE1,RCIE; RECEIVE INTERRUPT ENABLE BIT
;		CLRF	STATUS
;		BSF		INTCON,GIE
;		BSF		INTCON,PEIE
;		BSF		RCSTA,CREN
;	;	BSF		TXSTA,4 
;		BSF		TXSTA,TXEN	;ENABLE TRANSMITTER


CARRIAGEee	;CALL	LT
;			CALL	C
;			CALL	R
;			CALL	GT
			CALL	SLASH
			CALL	rr
	;		CALL	SLASH
	;		CALL	n
			RETURN

START	
		BSF		STATUS,5
		MOVLW	.1
		MOVWF	TRISB
		MOVLW	B'10000000'
		MOVWF	TRISC
		MOVLW	.0
		MOVWF	TRISD
;		BSF		TRISC,7    ;receive	INPUT
;		BCF		TRISC,6		;transmit OUTPUT
		MOVLW	07H
		MOVWF	OPTION_R
		CLRF	STATUS
		CLRF	PORTB
		CLRF	PORTC
		CLRF	PORTD	
		CLRF	FLAG
		BSF		STATUS,5
		MOVLW	.130
		MOVWF	SPBRG; FOR BAUD RATE
		MOVLW	24H;B'00100100' trasmit ealed high speed
		MOVWF	TXSTA
	;	BSF		PIE1,TXIE
		BSF		PIE1,RCIE
		CLRF	STATUS
		CLRF	INTCON
		MOVLW	90H	;10010000
		MOVWF	RCSTA
		BSF		INTCON,GIE
		BSF		INTCON,PEIE
		BCF		PIR1,RCIF

;WAITT	BTFSC	PORTB,0
;		GOTO	WAITT
;		BSF		PORTB,1
;		MOVLW	55H
;		MOVWF	TXREG		;SEND DATA
;
;	WAITr	BTFSS	PIR1,TXIF
;			GOTO	WAITr
;	QAIT	MOVLW	03FH
;			MOVWF	PORTB
;			GOTO	QAIT
;
;		CALL	A
;		CALL	CARRIAGE
;		CALL	DELAYWAIT
		CALL DELAYWAIT
		CALL DELAYWAIT
		CALL DELAYWAIT
		CALL DELAYWAIT
		CALL	A
		CALL	T
		CALL	CARRIAGE
		CALL	DELAYWAIT
		CALL	A	
		CALL	T
		CALL	PLUS
		CALL	I
		CALL	P
		CALL	R
		CALL	EQUAL
		CALL	M9
		CALL	M6
		CALL	M0
		CALL	M0
		CALL	CARRIAGE
		CALL	DELAYWAIT	;MAKE IT 2 SECO
	;	CALL	DELAYWAIT
		CALL	A
		CALL	T
		CALL	PLUS
		CALL	C
		CALL	F
		CALL	U
		CALL	N
		CALL	EQUAL
		CALL	M1
		CALL	CARRIAGE
		CALL	DELAYWAIT
		CLRF	PORTB
		BSF		PORTD,3
		BSF		PORTD,5
;		GOTO	text
		CALL	A
		CALL	T
		CALL	PLUS
		CALL	C
		CALL	M
		CALL	G
		CALL	F
		CALL	EQUAL
		CALL	M0
		CALL	CARRIAGE
		CALL	DELAYWAIT
;		CALL	A
;		CALL	T
;		CALL	E
;		CALL	M0
;		CALL	CARRIAGE
;		CALL	DELAYWAIT
;		CALL	DELAYWAIT
		
		CALL	A
		CALL	T
		CALL	D
	;	CALL	PLUS
;		CALL	M2
;		CALL	M3
;		CALL	M4
		CALL	M0
		CALL	M9
		CALL	M0
		CALL    M3
		CALL	M2
		CALL	M8
		CALL    M9
		CALL 	M2
		CALL	M0
		CALL	M4
		CALL	M0
;		CALL	SEMI
		CALL	CARRIAGE
	;	BSF		INTCON,PEIE
		CALL	DELAYWAIT
		CALL	DELAYWAIT
		CALL	DELAYWAIT
		GOTO	WAITR
;SWITCH TO TEXT
text	CALL	A
		CALL	T
		CALL	PLUS
		CALL	C
		CALL	M
		CALL	G
		CALL	F
		CALL	EQUAL
		CALL	M1
		CALL	CARRIAGE
;		CALL	DELAYWAIT
		CALL	DELAYWAIT
		CALL	A
		CALL	T
		CALL	PLUS
		CALL	C
		CALL	M
		CALL	G
	;	CALL	R
	;	CALL	EQUAL
	;	CALL	M1
		CALL	S
		CALL	EQUAL
		CALL	QUO
		CALL	PLUS
		CALL	M2
		CALL	M3
		CALL	M4
	;	CALL	M0
		CALL	M9
		CALL	M0
		CALL    M3
		CALL	M2
		CALL	M8
		CALL    M9
		CALL 	M2
		CALL	M0
		CALL	M4
		CALL	M0	
		CALL	QUO
		CALL	CARRIAGE
		CALL	DELAYWAIT
		CALL	H
		CALL	I
		CALL	CtrlZ
		CALL	DELAYWAIT
		CALL	DELAYWAIT
		CALL	DELAYWAIT
		CALL	DELAYWAIT
	WAITR	BTFSS	FLAG,0
		;	GOTO	WAITR
		;	MOVF	RECV,W
			BSF		PORTD,0
			BSF		PORTD,1
			CLRF	PORTB
	WW		CALL	A
			CALL	T
			CALL	H
			CALL	M0			
			CALL	CARRIAGE
			CALL	DELAYWAIT
			GOTO	WW
	END